<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>llama.core documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Llama-core</span> <span class="project-version">0.1.0-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="01-intro.html"><div class="inner"><span>Introduction </span></div></a></li><li class="depth-1 "><a href="02-tutorial.html"><div class="inner"><span>Tutorial</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>llama</span></div></div></li><li class="depth-2 branch current"><a href="llama.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="llama.route.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>route</span></div></a></li><li class="depth-2"><a href="llama.testing.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>testing</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="llama.core.html#var-body"><div class="inner"><span>body</span></div></a></li><li class="depth-1"><a href="llama.core.html#var-exchange"><div class="inner"><span>exchange</span></div></a></li><li class="depth-1"><a href="llama.core.html#var-fail.21"><div class="inner"><span>fail!</span></div></a></li><li class="depth-1"><a href="llama.core.html#var-failed.3F"><div class="inner"><span>failed?</span></div></a></li><li class="depth-1"><a href="llama.core.html#var-fault.21"><div class="inner"><span>fault!</span></div></a></li><li class="depth-1"><a href="llama.core.html#var-fault.3F"><div class="inner"><span>fault?</span></div></a></li><li class="depth-1"><a href="llama.core.html#var-headers"><div class="inner"><span>headers</span></div></a></li><li class="depth-1"><a href="llama.core.html#var-id"><div class="inner"><span>id</span></div></a></li><li class="depth-1"><a href="llama.core.html#var-in"><div class="inner"><span>in</span></div></a></li><li class="depth-1"><a href="llama.core.html#var-message"><div class="inner"><span>message</span></div></a></li><li class="depth-1"><a href="llama.core.html#var-out"><div class="inner"><span>out</span></div></a></li><li class="depth-1"><a href="llama.core.html#var-out-capable.3F"><div class="inner"><span>out-capable?</span></div></a></li><li class="depth-1"><a href="llama.core.html#var-reply.21"><div class="inner"><span>reply!</span></div></a></li><li class="depth-1"><a href="llama.core.html#var-request-body"><div class="inner"><span>request-body</span></div></a></li><li class="depth-1"><a href="llama.core.html#var-send-body"><div class="inner"><span>send-body</span></div></a></li><li class="depth-1"><a href="llama.core.html#var-set-body.21"><div class="inner"><span>set-body!</span></div></a></li><li class="depth-1"><a href="llama.core.html#var-set-in.21"><div class="inner"><span>set-in!</span></div></a></li><li class="depth-1"><a href="llama.core.html#var-set-out.21"><div class="inner"><span>set-out!</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">llama.core</h1><div class="doc"><div class="markdown"><p>Core utilities for working with Camel endpoints, messages, exchanges, etc.</p></div></div><div class="public anchor" id="var-body"><h3>body</h3><div class="usage"><code>(body msg)</code><code>(body msg clazz)</code></div><div class="doc"><div class="markdown"><p>Get the body of the <code>msg</code>, a <code>Message</code>.</p>
<p>See <a href="llama.core.html#var-in">in</a> and <a href="llama.core.html#var-out">out</a> for getting the Message out of an Exchange.</p>
<p><em>Type conversions</em>. If <code>clazz</code> is provided use a <a href="http://camel.apache.org/type-converter.html">type converter</a> to cast it to <code>clazz</code>. Throws <a href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/NoTypeConversionAvailableException.html"><code>NoTypeConversionAvailableException</code></a> if conversion fails because the type converter isnâ€™t in the registry. Throws <code>TypeConversionException</code> if the conversion <em>itself fails</em>.</p>
<p>Uses the context of the exchange of msg. If <code>msg</code> has no exchange and context then the <code>DefaultCamelcontext</code> is used.</p>
<pre><code>;; read from a direct exchange, get the in part of the exchange,
;; get the body, serialize to json using Cheshire, get :foo from the dict 
;; and print
(route (from "direct:hello")                   
       (process                                  
         (fn [x] (-&gt;&gt; (in x)                   
                      body
                      cheshire.core/parse-string 
                      :foo                       
                      println))))                
</code></pre></div></div><div class="src-link"><a href="http://github.com/ane/llama/blob/master/src/llama/core.clj#L160">view source</a></div></div><div class="public anchor" id="var-exchange"><h3>exchange</h3><div class="usage"><code>(exchange on)</code><code>(exchange on in)</code><code>(exchange on in out)</code></div><div class="doc"><div class="markdown"><p>Create an exchange on context <code>on</code>. Can set <code>in</code> as the <code>In</code> message. If third arg is truthy, set the exchange pattern as <code>InOut</code>. See <a href="llama.core.html#var-message">message</a> and <a href="null">reply</a>.</p>
<p><code>on</code> can be either a context, another exchange or an endpoint.</p>
<pre><code>(body (in (exchange ctx (message "hi"))))
;; =&gt; "hi"

(out-capable? (exchange ctx (message "hi") :out))
;; =&gt; true
</code></pre></div></div><div class="src-link"><a href="http://github.com/ane/llama/blob/master/src/llama/core.clj#L20">view source</a></div></div><div class="public anchor" id="var-fail.21"><h3>fail!</h3><div class="usage"><code>(fail! exchange reason)</code></div><div class="doc"><div class="markdown"><p>Fail the exchange because of <code>reason</code>. <code>reason</code> can be a string or exception/throwable.</p></div></div><div class="src-link"><a href="http://github.com/ane/llama/blob/master/src/llama/core.clj#L81">view source</a></div></div><div class="public anchor" id="var-failed.3F"><h3>failed?</h3><div class="usage"><code>(failed? exchange)</code></div><div class="doc"><div class="markdown"><p>Has the exchange failed (its exception is non-nil) or any of its messages faulted? See also <a href="llama.core.html#var-fault.3F">fault?</a>.</p></div></div><div class="src-link"><a href="http://github.com/ane/llama/blob/master/src/llama/core.clj#L87">view source</a></div></div><div class="public anchor" id="var-fault.21"><h3>fault!</h3><div class="usage"><code>(fault! msg)</code></div><div class="doc"><div class="markdown"><p>Fault the message.</p></div></div><div class="src-link"><a href="http://github.com/ane/llama/blob/master/src/llama/core.clj#L93">view source</a></div></div><div class="public anchor" id="var-fault.3F"><h3>fault?</h3><div class="usage"><code>(fault? msg)</code></div><div class="doc"><div class="markdown"><p>Has the message faulted?</p></div></div><div class="src-link"><a href="http://github.com/ane/llama/blob/master/src/llama/core.clj#L98">view source</a></div></div><div class="public anchor" id="var-headers"><h3>headers</h3><div class="usage"><code>(headers msg)</code></div><div class="doc"><div class="markdown"><p>Get the headers of <code>msg</code> as a map.</p></div></div><div class="src-link"><a href="http://github.com/ane/llama/blob/master/src/llama/core.clj#L195">view source</a></div></div><div class="public anchor" id="var-id"><h3>id</h3><div class="usage"><code>(id msg)</code></div><div class="doc"><div class="markdown"><p>Get the message id of <code>msg</code>.</p></div></div><div class="src-link"><a href="http://github.com/ane/llama/blob/master/src/llama/core.clj#L200">view source</a></div></div><div class="public anchor" id="var-in"><h3>in</h3><div class="usage"><code>(in x)</code></div><div class="doc"><div class="markdown"><p>With 1 arg, get the body of the <strong>In</strong> part of an <code>InOut</code> exchange <code>x</code>.</p></div></div><div class="src-link"><a href="http://github.com/ane/llama/blob/master/src/llama/core.clj#L150">view source</a></div></div><div class="public anchor" id="var-message"><h3>message</h3><div class="usage"><code>(message body &amp; {:keys [id headers], :or {id nil, headers (hash-map)}})</code></div><div class="doc"><div class="markdown"><p>Create a Message, with <code>body</code> String as the body. Optionally with <code>:headers</code> (map) as the headers, and <code>:id</code> as the <a href="http://camel.apache.org/correlation-identifier.html">message id</a>.</p></div></div><div class="src-link"><a href="http://github.com/ane/llama/blob/master/src/llama/core.clj#L7">view source</a></div></div><div class="public anchor" id="var-out"><h3>out</h3><div class="usage"><code>(out x)</code></div><div class="doc"><div class="markdown"><p>With 1 arg, get the body of the <strong>Out</strong> part of an <code>InOut</code> exchange <code>x</code>.</p></div></div><div class="src-link"><a href="http://github.com/ane/llama/blob/master/src/llama/core.clj#L154">view source</a></div></div><div class="public anchor" id="var-out-capable.3F"><h3>out-capable?</h3><div class="usage"><code>(out-capable? x)</code></div><div class="doc"><div class="markdown"><p>If the Exchange in <code>x</code> is an <code>InOut</code> exchange or not.</p></div></div><div class="src-link"><a href="http://github.com/ane/llama/blob/master/src/llama/core.clj#L48">view source</a></div></div><div class="public anchor" id="var-reply.21"><h3>reply!</h3><div class="usage"><code>(reply! exchange body &amp; {:keys [headers id], :or {headers (hash-map), id nil}})</code></div><div class="doc"><div class="markdown"><p>Reply successfully to an exchange with <code>body</code>. <code>body</code> can be a String message or a <a href="http://camel.apache.org/message.html">Message</a>. If <code>body</code> is string it is converted into to a <code>Message</code> and the optional <code>headers</code> are inserted as the message headers and <code>:id</code> as the message ID. If <code>body</code> is already a Message its headers and id will be unaltered. See <a href="llama.core.html#var-message">message</a> and <a href="llama.core.html#var-request-body">request-body</a>.</p>
<p><strong>Note</strong>. Reply works only on an <a href="http://camel.apache.org/request-reply.html">InOut</a> Exchange. Does nothing if exchange is <code>InOnly</code>.</p>
<pre><code>(route 
   (from "vm:lol")
   (process (fn [x] (reply x "haha")))

(request-body ctx "vm:lol" "hi")
;; =&gt; "haha"
</code></pre></div></div><div class="src-link"><a href="http://github.com/ane/llama/blob/master/src/llama/core.clj#L53">view source</a></div></div><div class="public anchor" id="var-request-body"><h3>request-body</h3><div class="usage"><code>(request-body ctx endpoint body &amp; {:keys [headers], :or {headers {}}})</code></div><div class="doc"><div class="markdown"><p>Synchronously send to <code>endpoint</code> and expect a reply, returns the reply.</p>
<p>Send <code>body</code> (String) to <code>endpoint</code> using the <code>InOut</code> pattern. Optionally send headers in <code>headers</code>.</p>
<pre><code>(route (from "direct:foo")
       (process (fn [x] (reply x "Is it African or European?"))))

;; start the route, add to context, etc.

(request-body ctx "direct:foo" "How much weight can an unladen swallow carry?")
;; =&gt; "Is it African or European?"
</code></pre></div></div><div class="src-link"><a href="http://github.com/ane/llama/blob/master/src/llama/core.clj#L113">view source</a></div></div><div class="public anchor" id="var-send-body"><h3>send-body</h3><div class="usage"><code>(send-body ctx endpoint body &amp; {:keys [headers], :or {headers {}}})</code></div><div class="doc"><div class="markdown"><p>Synchronously send <code>body</code> as message to <code>endpoint</code>.</p>
<p>Sends <code>body</code> (String) to <code>endpoint</code>. Optionally add headers in <code>headers</code>.</p></div></div><div class="src-link"><a href="http://github.com/ane/llama/blob/master/src/llama/core.clj#L103">view source</a></div></div><div class="public anchor" id="var-set-body.21"><h3>set-body!</h3><div class="usage"><code>(set-body! msg body)</code></div><div class="doc"><div class="markdown"><p>Set the body of <code>msg</code> to body.</p></div></div><div class="src-link"><a href="http://github.com/ane/llama/blob/master/src/llama/core.clj#L134">view source</a></div></div><div class="public anchor" id="var-set-in.21"><h3>set-in!</h3><div class="usage"><code>(set-in! xchg m)</code></div><div class="doc"><div class="markdown"><p>Set the <strong>In</strong> part of an exchange to <code>m</code>.</p></div></div><div class="src-link"><a href="http://github.com/ane/llama/blob/master/src/llama/core.clj#L139">view source</a></div></div><div class="public anchor" id="var-set-out.21"><h3>set-out!</h3><div class="usage"><code>(set-out! xchg m)</code></div><div class="doc"><div class="markdown"><p>Set the <strong>Out</strong> part of an exchange to <code>m</code>. No-op on <strong>InOnly</strong> exchanges.</p></div></div><div class="src-link"><a href="http://github.com/ane/llama/blob/master/src/llama/core.clj#L144">view source</a></div></div></div></body></html>